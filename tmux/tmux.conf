# --- Basic Options ---
set -g mouse on
set -sg escape-time 1
set -g focus-events on
set -g prefix C-u
set -g history-limit 100000
unbind %

# --- Keybindings: Panes ---
bind C-h select-pane -L
bind C-j select-pane -D
bind C-k select-pane -U
bind C-l select-pane -R

bind C-s split-window -v -c "#{pane_current_path}" # Horizontal Split
bind C-v split-window -h -c "#{pane_current_path}" # Vertical Split

bind C-d kill-pane
bind C-z resize-pane -Z # Zoom toggle

# --- Keybindings: Sessions ---
bind C-f choose-tree -sZ -O name
bind C-o switch-client -l

# --- Keybindings: Windows ---
bind C-w new-window
unbind C-x
bind C-n next-window
bind C-b previous-window
bind C-m command-prompt 'rename-window %%'

# --- Keybindings: Layouts & Utils ---
bind C-r copy-mode
bind C-u set-window-option synchronize-panes
bind C-c send-keys C-a M-d 'find ~ -type d | fzf' Enter
bind C-y swap-pane -t 0 \; select-pane -t 0
bind C-t display-popup -w 32 -h 10 -E -d "#{pane_current_path}" "~/.local/bin/start-session"

bind C-p select-layout even-horizontal
bind C-i select-layout even-vertical
bind C-a select-layout main-vertical
bind C-q select-layout main-horizontal
bind C-e select-layout tiled
bind C-g select-layout tiled

# --- Copy Mode ---
set -s copy-command 'wl-copy'
setw -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'V' send -X select-line
bind-key -T copy-mode-vi 'r' send -X rectangle-toggle
bind-key -T copy-mode-vi 'y' send -X copy-pipe-and-cancel

# --- UI Styles ---
set -g status-position top
set -g status-justify absolute-centre
set -g status on

# Minimal status background
set -g status-style 'bg=default,fg=colour7'

# Pane borders: subtle gray for both inactive and active
set -g pane-border-style 'fg=colour8,bg=default'
set -g pane-active-border-style 'fg=colour8,bg=default'
set -g pane-border-lines single
set -g pane-border-indicators off

# UI colors for modes and messages
set -g display-panes-active-colour colour7
set -g display-panes-colour colour8
set -g menu-border-style 'fg=colour8'
set -g popup-border-style 'fg=colour8'

# Selection and scrollback position box: subtle Gray on White (matching borders)
set -g mode-style 'bg=colour4,fg=colour0'
set -g message-style 'bg=colour8,fg=colour7'
set -g copy-mode-position-format '#[align=right][#{scroll_position}/#{history_size}]'

# Top pane border to act as a separator under the tab row
set -g pane-border-status top
set -g pane-border-format ''

set -g status-left-length 30
set -g status-left '#[fg=colour8]â€º#[fg=colour7] #S'
set -g status-right-length 200
set -g status-right '#{S:#{?#{&&:#{m:*!*,#{session_alert}},#{!=:#{session_name},#{client_session}}},  #[fg=colour8]#{session_name}#[fg=colour3]!,}}'
set -g status-interval 2

# Minimal window status: gray inactive, blue brackets with white text for active
setw -g window-status-style 'fg=colour8'
setw -g window-status-format '   #W#{?window_bell_flag,#[fg=colour3]!,}   '
setw -g window-status-current-format '  #[fg=colour4][#[fg=colour7]#W#{?window_bell_flag,#[fg=colour3]!,}#[fg=colour4]]  '
setw -g window-status-bell-style 'fg=colour8,bg=default'
setw -g window-status-activity-style 'fg=colour2,bg=default,bold'

# --- Modern Terminal Features ---
set -s extended-keys on
set -g allow-passthrough on
# Forward bells from all panes to the host terminal (for Agent notifications)
set -g bell-action any
# Monitor for bell alerts (visual '!' indicator in status bar)
set -g monitor-bell on

set -g default-terminal 'tmux-256color'
set -as terminal-features ',*-256color*:RGB:cstyle:hyperlinks:title'
set -as terminal-features ',xterm-ghostty*:RGB:cstyle:hyperlinks:title'

# Dynamically update the host terminal's title
set -g set-titles on
set -g set-titles-string "#T - #W"

# Make cursor blinking-block by default in tmux
set -wg cursor-style blinking-block
